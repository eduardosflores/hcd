{% extends 'base.html.twig' %}
{% block title %}
    Asignar Proyectos a BAE
{% endblock title %}
{% block body %}

    <div class="modal fade" id="modal-editar-extracto" tabindex="-1" role="dialog"
         aria-labelledby="modal-editar-extracto">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="modal-editar-extracto">{{ "Editar Extracto" |trans }}!</h4>
                </div>
                <div class="error"></div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"
                            data-dismiss="modal">{{ 'Cerrar'|trans }}</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">Asignar Proyectos a BAE - {{ sesion.titulo }}</h3>
                    <div class="box-tools pull-right">

                    </div>
                </div>
                <div class="box-body">
                    {{ form_start(form) }}
                    {{ form_widget(form) }}
                    <button class="btn btn-primary"><i class="fa fa-save"></i> Guardar</button>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <a class="btn btn-default" href="{{ path('sesiones_conformar_plan_de_labor_index') }}">Volver</a>
        </div>
    </div>
{% endblock body %}
{% block javascripts %}
    <script>
        $(document).ready(function () {

            $(document).ajaxStop($.unblockUI);

            $('.btn-editar-extracto').click(function () {
                console.log('id', $(this).data('id'))

                $.blockUI({
                    message: '<div class="progress">\n' +
                    '                <div class="progress-bar progress-bar-primary progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n' +
                    '                </div>\n' +
                    '              </div>',
                    css: {border: 'none', background: ''}
                });

                var id = $(this).data('id');

                $.ajax({
                    type: 'get',
                    url: '{{ path('render_extracto_temario_form') }}',
                    data: {id: id},
                    success: function (data) {
                        $('#modal-editar-extracto .modal-body').html(data.form);
                        $('#modal-editar-extracto').modal('toggle');

                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                    }
                });

            });


            $(document).on('submit', '#editar-extracto-temario-form', function (event) {

                $.blockUI({
                    message: '<div class="progress">\n' +
                    '                <div class="progress-bar progress-bar-primary progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n' +
                    '                </div>\n' +
                    '              </div>',
                    css: {border: 'none', 'z-index': '1051', background: ''}
                });

                $('.btn-submit-extracto').addClass('disabled');
                $('.btn-submit-extracto').html('<i class="fa fa-circle-o-notch fa-spin"></i> Guardando');

                event.preventDefault();
                var id = $(this).data('id');

                $.ajax({
                    type: $(this).attr('method'),
                    url: '{{ path('render_extracto_temario_form') }}',
                    data: {id: id, data: $(this).serialize()},
                    dataType: 'json',
                })
                    .done(function (data) {
                        if (typeof data.message !== 'undefined') {
                            // alert(data.message);
                            $('#modal-editar-extracto').modal('toggle');
                            modalAlert(data.message)

                        }
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        if (typeof jqXHR.responseJSON !== 'undefined') {
                            if (jqXHR.responseJSON.hasOwnProperty('form')) {
                                $('#modal-editar-extracto .modal-body').html(jqXHR.responseJSON.form);
                            }

                            $('#modal-editar-extracto .error').html(jqXHR.responseJSON.message);

                        } else {
                            alert(errorThrown);
                        }

                    });
            })
        });
    </script>
{% endblock javascripts %}