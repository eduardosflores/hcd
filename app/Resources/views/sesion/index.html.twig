<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sesión HCD</title>
    <link rel="stylesheet" href="{{ asset('build/global.css') }}">
    <link rel="stylesheet" href="{{ asset('build/common.css') }}">
    <link rel="stylesheet" href="{{ asset('build/app.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/theme/css/custom.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/theme/admin-lte/css/AdminLTE.min.css') }}">
    <style>

        .btn-primary-hcd {
            background-color: #12a9d4;
            border-color: #12a9d4;
            color: #fff;
        }

        .navbar-fixed-top {
            background-color: #17a867;
            padding: 1%;
        }

        dl dt {
            float: left;
            width: 33%;
            overflow: hidden;
            clear: left;
            text-align: right;
            white-space: nowrap;
        }

        dl dd {
            margin-left: 35%;
        }

        dd {
            text-align: justify;
        }
    </style>
    <script>
        window.user = {id: {{ app.user.id }} };
        window.baseUrl = '{{ path('app_homepage') }}';
    </script>
</head>
<body>

<div class="container">

    {#modal#}
    <div id="modal-dictamen" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
         aria-labelledby="modal-dictamen">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    Expte
                </div>
                <div class="modal-body">
                    <div class="cuerpo">

                    </div>

                </div>
            </div>
        </div>
    </div>
    {#modal#}

    <div class="row">
        {% if is_granted('ROLE_CONCEJAL') %}
            <div id="app">
                <panel-concejal path-logout="{{ path('sesion_logout') }}"
                                path-carta-organica="{{ asset('uploads/documentos/') ~ cartaOrganica.documento }}"
                                concejal="{{ concejal }}">

                    <template slot="od">
                        {% if sesion.ordenDelDia %}
                            {{ sesion.ordenDelDia | raw }}
                        {% else %}
                            {% for titulo, lista in dictamenes %}
                                {% if lista.count %}
                                    <h3 style="text-align: center; margin-top: 5%"><u>{{ titulo }}</u></h3>
                                    <div class="cuerpo">
                                        <p>
                                        <dl class="dl-horizontal">
                                            {% for dictamen in lista %}
                                                <dt><strong><a  class="ver-dictamen"
                                                               data-id-expediente="{{ dictamen.id }}">EXPTE.
                                                            Nº {{ dictamen.expediente }}</a></strong></dt>
                                                <dd>{{ dictamen.expediente.extractoDictamen | raw }}</dd>
                                            {% endfor %}
                                        </dl>
                                        </p>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </template>
                    <template slot="bae">
                        {% if sesion.asuntosEntrados %}
                            {{ sesion.asuntosEntrados | raw }}
                        {% else %}
                            {% for titulo, lista in proyectos %}
                                {% if lista.count %}
                                    <h3 style="text-align: center; margin-top: 5%"><u>{{ titulo }}</u></h3>
                                    <div class="cuerpo">

                                        {% for proyecto in lista %}
                                            <div class="proyecto">
                                                <p>
                                                <dl class="dl-horizontal">
                                                    <dt><strong>EXPTE. Nº {{ proyecto.expediente }}</strong></dt>
                                                    <dd>{{ proyecto.expediente.extractoTemario | raw }}</dd>
                                                </dl>
                                                </p>
                                                <p style="text-align: center">
                                                    {% if proyecto.expediente.giros.count > 1 %}
                                                        A las Comisiones de
                                                    {% else %}
                                                        A la Comisión de
                                                    {% endif %}

                                                    {% if proyecto.expediente.girosOrdenados.count <= 2 %}
                                                        {% if proyecto.expediente.girosOrdenados.count == 1 %}
                                                            {% for giro in proyecto.expediente.girosOrdenados %}
                                                                <strong>{{ giro.comisionDestino.abreviacion }}</strong>
                                                            {% endfor %}
                                                        {% else %}
                                                            {% for giro in proyecto.expediente.girosOrdenados %}
                                                                <strong>{{ giro.comisionDestino.abreviacion }}</strong> {% if not loop.last %} y de {% endif %}
                                                            {% endfor %}
                                                        {% endif %}
                                                    {% else %}
                                                        {% for giro in proyecto.expediente.girosOrdenados %}
                                                            {% set ender = '; ' %}
                                                            {% if loop.index == (loop.length - 1) %}
                                                                {% set ender = ' y de ' %}
                                                            {% endif %}
                                                            <strong>{{ giro.comisionDestino.abreviacion }}</strong>{{ ender }}
                                                        {% endfor %}
                                                    {% endif %}

                                                </p>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </template>
                </panel-concejal>
            </div>
        {% endif %}
        {% if is_granted('ROLE_SECRETARIO') %}
            {% include 'sesion/autoridades.html.twig' %}
        {% endif %}

        <div class="col-md-12">

        </div>
    </div>
    <div class="row">
        <hr>
        <div class="col-md-12">
            <h2>
                {% if is_granted('ROLE_CONCEJAL') %}
                    Concejal {{ concejal }}
                {% endif %}
                {% if is_granted('ROLE_SECRETARIO') %}
                    Secretario
                {% endif %}
            </h2>
        </div>
    </div>
</div>

</body>

<script src="{{ asset('build/common-js.js') }}"></script>
<script>
    $(document).ready(function () {
        $(document).ajaxStop($.unblockUI);
    });
    $(document).on('click', '.ver-dictamen', function () {
        console.log('id', $(this).data('id-expediente'))

        var idExpte = $(this).data('id-expediente');

        $.blockUI({
            message: '<div class="progress">\n' +
            '                <div class="progress-bar progress-bar-primary progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n' +
            '                </div>\n' +
            '              </div>',
            css: {border: 'none', background: ''}
        });

        $.ajax({
            type: 'get',
            url: '{{ path('ver_dictamen') }}',
            data: {id: idExpte},
            success: function (data) {

                $('#modal-dictamen .modal-header').html(data.expediente);

                $('#modal-dictamen .modal-body').html(data.texto);

                if (data.firmantes){
                    $('#modal-dictamen .modal-body').append('<h4>Firmantes</h4>');
                    data.firmantes.forEach(function(element) {
                        $('#modal-dictamen .modal-body').append(element + '<br>');
                    });
                }

                $('#modal-dictamen').modal('toggle')

            },
            error: function (jqXHR, textStatus, errorThrown) {

            }
        });
    })
</script>
<script src="{{ asset('build/app.js') }}"></script>
</html>